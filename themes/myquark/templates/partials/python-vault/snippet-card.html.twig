{% set is_list = is_list|default(false) %}
{% set heading_tag = is_list ? 'h2' : 'h1' %}
{% set code_medium = snippet.media['snippet.py'] ?? null %}
{% if code_medium is null %}
    {% for medium in snippet.media.files if medium.extension == 'py' %}
        {% set code_medium = medium %}
    {% endfor %}
{% endif %}
{% set code_source = code_medium ?: snippet %}
{% set code_content = python_vault_snippet_code(code_source)|trim %}
{% set code_block_id = 'python-vault-code-' ~ snippet.slug %}
{% set snippet_tags = snippet.taxonomy['snippet-tags']|default([]) %}
{% set search_source = (snippet.title ~ ' ' ~ snippet_tags|join(' ') ~ ' ' ~ snippet.content|striptags)|lower|replace({'\n': ' '}) %}
{% set suggested_by = attribute(snippet.header, 'suggested-by')|default(null) %}

<article class="python-vault__snippet" data-python-vault-card data-search-text="{{ search_source|e('html_attr') }}">
    <header class="python-vault__snippet-header">
        <{{ heading_tag }} class="python-vault__snippet-title">
            {% if suggested_by %}
                <span class="python-vault__snippet-suggester">suggested by {{ suggested_by }}</span>
            {% endif %}
            {% if is_list %}
                <a href="{{ snippet.url }}">{{ snippet.title }}</a>
            {% else %}
                {{ snippet.title }}
            {% endif %}
        </{{ heading_tag }}>

        {% if snippet_tags %}
            <div class="python-vault__snippet-meta">
                <ul class="python-vault__tags">
                    {% for tag in snippet_tags %}
                        <li>
                            <button type="button" class="python-vault__tag" data-python-vault-tag="{{ tag }}" aria-label="Search for the '{{ tag }}' snippet tag">{{ tag }}</button>
                        </li>
                    {% endfor %}
                </ul>
            </div>
        {% endif %}
    </header>

    {% if code_content %}
        <div class="python-vault__code">
            <pre><code id="{{ code_block_id }}" class="language-python">{{ code_content|e }}</code></pre>
        </div>
    {% endif %}

    {% if code_content or snippet.header.python_version %}
        <div class="python-vault__actions">
            {% if code_content %}
                <button type="button" class="python-vault__copy" data-copy-target="#{{ code_block_id }}">Copy code</button>
            {% endif %}
            {% if snippet.header.python_version %}
                <span class="python-vault__badge" title="Minimum Python version">Python {{ snippet.header.python_version }}</span>
            {% endif %}
        </div>
    {% endif %}

    {% if snippet.content %}
        {% set content_split = snippet.content|split('</p>', 2) %}
        {% set first_paragraph = content_split[0] %}
        {% if '</p>' in snippet.content %}
            {% set first_paragraph = first_paragraph ~ '</p>' %}
        {% endif %}

        <div class="python-vault__description">
            {{ first_paragraph|raw }}
        </div>
    {% endif %}
</article>
