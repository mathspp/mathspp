{% extends 'partials/base.html.twig' %}
{% set python_vault_add_snippet_url = 'https://github.com/mathspp/mathspp/issues/new/choose' %}
{% set hero_image_url = header_var('hero_image_url', [page])|defined('') %}
{% set python_vault_hero_image = page.media.images[page.header.hero_image] ?: page.media.images|first %}
{% set has_python_vault_hero = hero_image_url != '' or python_vault_hero_image is not empty %}
{% set python_vault_hero_content %}
    <h1>{{ page.title }}</h1>
    {% if page.content %}
        {{ page.content|raw }}
    {% endif %}
    <div class="python-vault__cta python-vault__cta--hero">
        {% include 'partials/python-vault/add-snippet-button.html.twig' with { url: python_vault_add_snippet_url } %}
    </div>
{% endset %}

{% block hero %}
    {% if has_python_vault_hero %}
        {% include 'partials/hero.html.twig' with {
            id: 'python-vault-hero',
            content: python_vault_hero_content,
            hero_image_url: hero_image_url,
            hero_image: python_vault_hero_image
        } %}
    {% endif %}
{% endblock %}

{% block stylesheets %}
    {% do assets.addCss('theme://css/python-vault.css') %}
    {{ parent() }}
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    {% do assets.addJs('theme://js/python-vault.js', { group: 'bottom', loading: 'defer' }) %}
{% endblock %}

{% block content %}
    <section class="python-vault">
        {% if not has_python_vault_hero %}
            <header class="python-vault__header">
                <h1>{{ page.title }}</h1>
                {% if page.content %}
                    <div class="python-vault__intro">
                        {{ page.content|raw }}
                    </div>
                {% endif %}
                <div class="python-vault__cta">
                    {% include 'partials/python-vault/add-snippet-button.html.twig' with { url: python_vault_add_snippet_url } %}
                </div>
            </header>
        {% endif %}

        <div class="python-vault__controls">
            <label for="python-vault-search" class="python-vault__search-label">Search snippets</label>
            <div class="python-vault__search-group">
                <input type="search"
                       id="python-vault-search"
                       class="python-vault__search-input"
                       placeholder="Search by description or tag..."
                       autocomplete="off"
                       data-python-vault-search>
                <button type="button"
                        class="python-vault__copy-results"
                        data-python-vault-copy-results>
                    Copy URL to these results
                </button>
            </div>
        </div>

        <p class="python-vault__no-results" data-python-vault-no-results hidden>No snippets match your search yet.</p>

        <div class="python-vault__list">
            {% set snippets = page.collection({ items: '@self.children', order: { by: 'title', dir: 'asc' } }) %}
            {% for snippet in snippets %}
                {% include 'partials/python-vault/snippet-card.html.twig' with { snippet: snippet, is_list: true } %}
            {% endfor %}
        </div>

        <div class="python-vault__cta python-vault__cta--list-bottom">
            {% include 'partials/python-vault/add-snippet-button.html.twig' with { url: python_vault_add_snippet_url } %}
        </div>
    </section>
{% endblock %}

